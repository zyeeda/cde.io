// Generated by CoffeeScript 1.3.3
(function() {
  var json, paths, router, scriptFolder, servletContext;

  paths = require('coala/util').paths;

  json = require('coala/response').json;

  servletContext = null;

  scriptFolder = '/scripts';

  router = exports.router = require('coala/router').createRouter();

  exports.setScriptFolder = function(path) {
    return scriptFolder = path;
  };

  router.get('/', function(request) {
    var files, findFile, root;
    if (servletContext === null) {
      servletContext = request.env.servletRequest.getSession(true).getServletContext();
    }
    root = request.params.root;
    root = paths.join(scriptFolder, root);
    if (root.charAt(root.length - 1) !== '/') {
      root = root + '/';
    }
    files = {};
    findFile = function(folder) {
      var file, fileHolder, filename, fs, idx, it, withoutExt;
      fs = servletContext.getResourcePaths(folder);
      it = fs.iterator();
      fileHolder = files[folder] || (files[folder] = {});
      while (it.hasNext()) {
        file = it.next();
        if (file.charAt(file.length - 1) === '/') {
          findFile(file);
        } else {
          idx = file.lastIndexOf('/');
          filename = file.substring(idx + 1);
          idx = filename.lastIndexOf('.');
          withoutExt = idx === -1 ? filename : filename.substring(0, idx);
          fileHolder[filename] = true;
          fileHolder[withoutExt] = true;
        }
      }
      return null;
    };
    findFile(root);
    return json(files);
  });

}).call(this);
